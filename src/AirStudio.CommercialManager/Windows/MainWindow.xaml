<Window x:Class="AirStudio.CommercialManager.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:AirStudio.CommercialManager.Controls"
        mc:Ignorable="d"
        Title="AirStudio Commercial Manager"
        Height="900" Width="1400"
        MinHeight="700" MinWidth="1200"
        WindowState="Maximized"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <!-- Title bar -->
            <RowDefinition Height="40"/>
            <!-- Main content (sidebar + three panels) -->
            <RowDefinition Height="*"/>
            <!-- Status bar -->
            <RowDefinition Height="28"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Grid Grid.Row="0" Background="{DynamicResource PrimaryMidBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- App Title -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                <TextBlock Text="AIRSTUDIO" FontSize="16" FontWeight="Bold" Foreground="#FFFFFF" VerticalAlignment="Center"/>
                <TextBlock Text=" COMMERCIAL MANAGER" FontSize="16" FontWeight="Light" Foreground="#B0C4DE" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Channel Selector (animated until selected) -->
            <Border Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Channel:" Foreground="#B0C4DE" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox x:Name="ChannelComboBox"
                              Width="200"
                              IsEnabled="True"
                              ToolTip="Select a channel to begin">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedItem, RelativeSource={RelativeSource Self}}" Value="{x:Null}">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                    <ColorAnimation Storyboard.TargetProperty="(ComboBox.BorderBrush).(SolidColorBrush.Color)"
                                                                    From="#3D5A80" To="#5A8FC4" Duration="0:0:0.8"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ComboBox.Style>
                    </ComboBox>
                </StackPanel>
            </Border>

            <!-- Configuration Button (Admin Only) -->
            <Button x:Name="ConfigButton"
                    Grid.Column="2"
                    Content="Configuration"
                    Style="{StaticResource RibbonButtonStyle}"
                    Visibility="Collapsed"
                    Click="ConfigButton_Click"
                    Margin="0,0,8,0"/>

            <!-- Window Controls -->
            <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,4,0">
                <Button x:Name="MinimizeButton" Content="—" Width="40" Height="30"
                        Style="{StaticResource RibbonButtonStyle}" Click="MinimizeButton_Click"/>
                <Button x:Name="MaximizeButton" Content="☐" Width="40" Height="30"
                        Style="{StaticResource RibbonButtonStyle}" Click="MaximizeButton_Click"/>
                <Button x:Name="CloseButton" Content="X" Width="40" Height="30"
                        Click="CloseButton_Click">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource RibbonButtonStyle}">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#C42B1C"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Content Area - Vertical Sidebar + Three Panels -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <!-- Vertical sidebar -->
                <ColumnDefinition Width="48"/>
                <!-- Main panels -->
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Vertical Sidebar -->
            <Border Grid.Column="0" Background="#0F2540" BorderBrush="#3D5A80" BorderThickness="0,0,1,0">
                <StackPanel Margin="4,8">
                    <Button x:Name="BroadcastSheetButton" Width="40" Height="40"
                            Style="{StaticResource RibbonButtonStyle}"
                            Click="BroadcastSheetButton_Click" IsEnabled="False"
                            ToolTip="Export broadcast sheet to PDF">
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="18"/>
                    </Button>
                    <Button x:Name="AgenciesButton" Width="40" Height="40" Margin="0,4,0,0"
                            Style="{StaticResource RibbonButtonStyle}"
                            Click="AgenciesButton_Click" IsEnabled="False"
                            ToolTip="Manage advertising agencies">
                        <TextBlock Text="&#xE716;" FontFamily="Segoe MDL2 Assets" FontSize="18"/>
                    </Button>
                    <Button x:Name="LibraryCleanupButton" Width="40" Height="40" Margin="0,4,0,0"
                            Style="{StaticResource RibbonButtonStyle}"
                            Click="LibraryCleanupButton_Click" IsEnabled="False"
                            ToolTip="Clean up old commercials">
                        <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="18"/>
                    </Button>
                    <Button x:Name="ActivityLogButton" Width="40" Height="40" Margin="0,4,0,0"
                            Style="{StaticResource RibbonButtonStyle}"
                            Click="ActivityLogButton_Click"
                            ToolTip="View activity log">
                        <TextBlock Text="&#xE8FD;" FontFamily="Segoe MDL2 Assets" FontSize="18"/>
                    </Button>

                    <Separator Margin="4,12" Background="#3D5A80"/>

                    <Button x:Name="RefreshAllButton" Width="40" Height="40"
                            Style="{StaticResource RibbonButtonStyle}"
                            Click="RefreshAllButton_Click" IsEnabled="False"
                            ToolTip="Refresh all panels (F5)">
                        <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="18"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Hidden status label for compatibility -->
            <TextBlock x:Name="ToolbarStatusLabel" Visibility="Collapsed"/>

            <!-- Three Vertical Panels -->
            <Grid Grid.Column="1" Margin="8">
            <Grid.RowDefinitions>
                <!-- Top: Scheduled Commercials (1/3) -->
                <RowDefinition Height="*" MinHeight="150"/>
                <RowDefinition Height="5"/>
                <!-- Middle: Commercial Library (1/3) -->
                <RowDefinition Height="*" MinHeight="150"/>
                <RowDefinition Height="5"/>
                <!-- Bottom: Playlist Creator + Waveform (1/3) -->
                <RowDefinition Height="*" MinHeight="200"/>
            </Grid.RowDefinitions>

            <!-- TOP PANEL: Scheduled Commercials -->
            <Border Grid.Row="0" Style="{StaticResource StudioPanel}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="SCHEDULED COMMERCIALS" FontWeight="Bold" FontSize="13"
                                   Foreground="#B0C4DE" VerticalAlignment="Center"/>
                        <TextBlock x:Name="ScheduledCountLabel" Text=" (0 items)"
                                   Foreground="#607D8B" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Search/Filter Bar -->
                    <Grid Grid.Row="1" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="ScheduleSearchTextBox" Grid.Column="0" Height="28"
                                 VerticalContentAlignment="Center"
                                 TextChanged="ScheduleSearchTextBox_TextChanged">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush AlignmentX="Left" Stretch="None">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="  Search schedules..." Foreground="#607D8B" Margin="5,0,0,0"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <TextBlock Grid.Column="1" Text="From:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="12,0,4,0"/>
                        <DatePicker x:Name="ScheduleFromDatePicker" Grid.Column="2" Width="120"
                                    SelectedDateChanged="ScheduleDateFilter_Changed"/>

                        <TextBlock Grid.Column="3" Text="To:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <DatePicker x:Name="ScheduleToDatePicker" Grid.Column="4" Width="120"
                                    HorizontalAlignment="Left"
                                    SelectedDateChanged="ScheduleDateFilter_Changed"/>

                        <Button Grid.Column="5" x:Name="RefreshSchedulesButton" Content="Refresh"
                                Width="70" Height="28"
                                Click="RefreshSchedulesButton_Click"/>
                    </Grid>

                    <!-- Schedules DataGrid -->
                    <DataGrid Grid.Row="2" x:Name="ScheduledGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              SelectionChanged="ScheduledGrid_SelectionChanged"
                              MouseDoubleClick="ScheduledGrid_MouseDoubleClick">
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Edit Schedule" Click="EditSchedule_Click"/>
                                <MenuItem Header="Delete Schedule" Click="DeleteSchedule_Click"/>
                                <Separator/>
                                <MenuItem Header="View TAG File" Click="ViewTagFile_Click"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tx Date" Binding="{Binding TxDate, StringFormat='{}{0:dd-MMM-yy}'}" Width="90" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Time" Binding="{Binding TxTimeDisplay}" Width="60" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Capsule Name" Binding="{Binding CapsuleName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="70" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Valid Until" Binding="{Binding ToDate, StringFormat='{}{0:dd-MMM-yy}'}" Width="90" IsReadOnly="True"/>
                            <DataGridTextColumn Header="User" Binding="{Binding UserName}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="70" IsReadOnly="True"/>
                            <DataGridTextColumn Header="TAG File" Binding="{Binding TagFileName}" Width="*" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Empty state -->
                    <Border x:Name="ScheduledEmptyState" Grid.Row="2" Visibility="Collapsed">
                        <TextBlock Style="{StaticResource EmptyHint}"
                                   Text="No scheduled commercials found. Create a schedule using the Playlist Creator below."/>
                    </Border>
                </Grid>
            </Border>

            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" Background="Transparent"/>

            <!-- MIDDLE PANEL: Commercial Library -->
            <Border Grid.Row="2" Style="{StaticResource StudioPanel}"
                    AllowDrop="True"
                    Drop="LibraryPanel_Drop"
                    DragOver="LibraryPanel_DragOver">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="COMMERCIAL LIBRARY" FontWeight="Bold" FontSize="13"
                                   Foreground="#B0C4DE" VerticalAlignment="Center"/>
                        <TextBlock x:Name="LibraryCountLabel" Text=" (0 items)"
                                   Foreground="#607D8B" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Search/Filter Bar -->
                    <Grid Grid.Row="1" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="LibrarySearchTextBox" Grid.Column="0" Height="28"
                                 VerticalContentAlignment="Center"
                                 TextChanged="LibrarySearchTextBox_TextChanged">
                            <TextBox.Style>
                                <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush AlignmentX="Left" Stretch="None">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="  Search by spot, title, or agency..." Foreground="#607D8B" Margin="5,0,0,0"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <Button Grid.Column="1" x:Name="AddCommercialButton" Content="+ Add New"
                                Width="80" Height="28" Margin="8,0,0,0"
                                Click="AddCommercialButton_Click" IsEnabled="False"/>
                        <Button Grid.Column="2" x:Name="RefreshLibraryButton" Content="Refresh"
                                Width="70" Height="28" Margin="4,0,0,0"
                                Click="RefreshLibraryButton_Click"/>
                    </Grid>

                    <!-- Library DataGrid -->
                    <DataGrid Grid.Row="2" x:Name="LibraryGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Extended"
                              SelectionChanged="LibraryGrid_SelectionChanged"
                              MouseDoubleClick="LibraryGrid_MouseDoubleClick"
                              PreviewMouseLeftButtonDown="LibraryGrid_PreviewMouseLeftButtonDown"
                              PreviewMouseMove="LibraryGrid_PreviewMouseMove">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Spot Name" Binding="{Binding Spot}" Width="150" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Agency" Binding="{Binding Agency}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="70" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Last Update" Binding="{Binding LastUpdate, StringFormat='{}{0:dd-MMM-yy}'}" Width="*" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Drop overlay -->
                    <Border x:Name="LibraryDropOverlay" Grid.Row="2" Background="#2A3D5A"
                            CornerRadius="8" Visibility="Collapsed">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Drop audio files here to add to library" FontSize="16"
                                       Foreground="#B0C4DE" HorizontalAlignment="Center"/>
                            <TextBlock Text="Supported: WAV, MP3, AIFF, M4A, WMA, OGG, FLAC"
                                       Foreground="#607D8B" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Hint row -->
                    <TextBlock Grid.Row="3" Text="Drag items to Playlist Creator below | Double-click to add | Drop audio files to import"
                               Foreground="#607D8B" FontSize="11" Margin="0,4,0,0"/>
                </Grid>
            </Border>

            <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" Background="Transparent"/>

            <!-- BOTTOM PANEL: Playlist Creator + Waveform -->
            <Border Grid.Row="4" Style="{StaticResource StudioPanel}"
                    AllowDrop="True"
                    Drop="PlaylistPanel_Drop"
                    DragOver="PlaylistPanel_DragOver">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="120"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header with action buttons -->
                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="PLAYLIST CREATOR" FontWeight="Bold" FontSize="13"
                                   Foreground="#B0C4DE" VerticalAlignment="Center"/>

                        <!-- Compact action buttons in header -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                            <Button x:Name="MoveUpButton" Content="&#x25B2;" Width="28" Height="24"
                                    Click="MoveUpButton_Click" IsEnabled="False"
                                    ToolTip="Move Up" FontSize="10"/>
                            <Button x:Name="MoveDownButton" Content="&#x25BC;" Width="28" Height="24"
                                    Click="MoveDownButton_Click" IsEnabled="False" Margin="2,0,0,0"
                                    ToolTip="Move Down" FontSize="10"/>
                            <Button x:Name="RemoveItemButton" Content="&#x2715;" Width="28" Height="24"
                                    Click="RemoveItemButton_Click" IsEnabled="False" Margin="2,0,0,0"
                                    ToolTip="Remove"/>
                            <Button x:Name="ClearPlaylistButton" Content="Clear" Width="50" Height="24"
                                    Click="ClearPlaylistButton_Click" IsEnabled="False" Margin="2,0,0,0"
                                    ToolTip="Clear All"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                            <TextBlock Text="Duration:" Foreground="#607D8B" VerticalAlignment="Center"/>
                            <TextBlock x:Name="TotalDurationLabel" Text="00:00:00" FontFamily="Consolas"
                                       Foreground="#5A8FC4" FontWeight="Bold" VerticalAlignment="Center" Margin="4,0,0,0"/>
                        </StackPanel>
                    </Grid>

                    <!-- Schedule Fields -->
                    <Grid Grid.Row="1" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Capsule:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox x:Name="CapsuleNameTextBox" Grid.Column="1" Height="28"
                                 VerticalContentAlignment="Center"
                                 TextChanged="CapsuleNameTextBox_TextChanged"/>

                        <TextBlock Grid.Column="2" Text="Tx Date:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="12,0,4,0"/>
                        <DatePicker x:Name="TxDatePicker" Grid.Column="3" Width="120"/>

                        <TextBlock Grid.Column="4" Text="Time:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <StackPanel Grid.Column="5" Orientation="Horizontal">
                            <TextBox x:Name="TxHourTextBox" Width="35" Height="28" Text="00"
                                     MaxLength="2" TextAlignment="Center"
                                     VerticalContentAlignment="Center"
                                     PreviewTextInput="TimeTextBox_PreviewTextInput"/>
                            <TextBlock Text=":" Foreground="#B0C4DE" VerticalAlignment="Center" Margin="2,0"/>
                            <TextBox x:Name="TxMinuteTextBox" Width="35" Height="28" Text="00"
                                     MaxLength="2" TextAlignment="Center"
                                     VerticalContentAlignment="Center"
                                     PreviewTextInput="TimeTextBox_PreviewTextInput"/>
                            <TextBlock Text=":" Foreground="#B0C4DE" VerticalAlignment="Center" Margin="2,0"/>
                            <TextBox x:Name="TxSecondTextBox" Width="35" Height="28" Text="00"
                                     MaxLength="2" TextAlignment="Center"
                                     VerticalContentAlignment="Center"
                                     PreviewTextInput="TimeTextBox_PreviewTextInput"/>
                        </StackPanel>

                        <TextBlock Grid.Column="6" Text="To Date:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <DatePicker x:Name="ToDatePicker" Grid.Column="7" Width="120"/>

                        <TextBlock Grid.Column="8" Text="User/Mobile:" Foreground="#B0C4DE"
                                   VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <StackPanel Grid.Column="9" Orientation="Horizontal">
                            <TextBox x:Name="UserNameTextBox" Width="100" Height="28"
                                     VerticalContentAlignment="Center" ToolTip="User Name"/>
                            <TextBox x:Name="MobileNoTextBox" Width="100" Height="28" Margin="4,0,0,0"
                                     VerticalContentAlignment="Center" ToolTip="Mobile Number"/>
                        </StackPanel>
                    </Grid>

                    <!-- Playlist Items (full width - buttons now in header) -->
                    <Grid Grid.Row="2">
                        <!-- Playlist DataGrid -->
                        <DataGrid x:Name="PlaylistGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  SelectionChanged="PlaylistGrid_SelectionChanged"
                                  AllowDrop="True"
                                  Drop="PlaylistGrid_Drop"
                                  DragOver="PlaylistGrid_DragOver">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="#" Binding="{Binding Order}" Width="35" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Spot Name" Binding="{Binding DisplayName}" Width="200" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Duration" Binding="{Binding DurationDisplay}" Width="80" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Agency" Binding="{Binding Agency}" Width="*" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Playlist drop overlay -->
                        <Border x:Name="PlaylistDropOverlay" Background="#2A5A8F"
                                CornerRadius="8" Opacity="0.95" Visibility="Collapsed">
                            <TextBlock Text="Drop here to add to playlist" FontSize="14"
                                       Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <!-- Empty state with hint -->
                        <Border x:Name="PlaylistEmptyHint" Background="#1A2A40"
                                CornerRadius="8" Margin="4">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Drag commercials here to build playlist" FontSize="14"
                                           Foreground="#B0C4DE" HorizontalAlignment="Center"/>
                                <TextBlock Text="or double-click items in the Library above" FontSize="11"
                                           Foreground="#607D8B" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                <Canvas Width="60" Height="30" Margin="0,8,0,0" HorizontalAlignment="Center">
                                    <Path Data="M30,5 L30,25 M20,15 L30,25 L40,15"
                                          Stroke="#5A8FC4" StrokeThickness="2"
                                          StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                        <Path.Style>
                                            <Style TargetType="Path">
                                                <Style.Triggers>
                                                    <EventTrigger RoutedEvent="Loaded">
                                                        <BeginStoryboard>
                                                            <Storyboard RepeatBehavior="Forever">
                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                 From="0.4" To="1" Duration="0:0:0.6"
                                                                                 AutoReverse="True"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </EventTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Path.Style>
                                    </Path>
                                </Canvas>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Waveform Viewer with integrated controls -->
                    <Border Grid.Row="3" Background="#0D1B2A" CornerRadius="6" Margin="0,8,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <controls:WaveformViewer Grid.Row="0" x:Name="WaveformViewer"/>

                            <!-- Integrated time and controls bar -->
                            <Grid Grid.Row="1" Margin="8,4,8,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Current time display -->
                                <TextBlock Grid.Column="0" x:Name="WaveformCurrentTime" Text="00:00:00"
                                           Foreground="#B0C4DE" FontFamily="Consolas" FontSize="11"
                                           VerticalAlignment="Center"/>

                                <!-- Playback controls (center) -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button x:Name="PreviewButton" Content="&#x25B6;" Width="36" Height="28"
                                            Click="PreviewButton_Click" IsEnabled="False"
                                            ToolTip="Play" FontSize="12"/>
                                    <Button x:Name="StopButton" Content="&#x25A0;" Width="36" Height="28"
                                            Click="StopButton_Click" IsEnabled="False" Margin="4,0,0,0"
                                            ToolTip="Stop" FontSize="12"/>
                                </StackPanel>

                                <!-- Total time + Save button -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <TextBlock x:Name="WaveformTotalTime" Text="00:00:00"
                                               Foreground="#B0C4DE" FontFamily="Consolas" FontSize="11"
                                               VerticalAlignment="Center"/>
                                    <Button x:Name="SaveScheduleButton" Content="Save &amp; Schedule"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Width="120" Click="SaveScheduleButton_Click" IsEnabled="False"
                                            Margin="12,0,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Validation message -->
                    <TextBlock Grid.Row="4" x:Name="ValidationLabel"
                               Foreground="#FF6B6B" Margin="0,4,0,0"/>
                </Grid>
            </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{DynamicResource PrimaryMidBrush}">
            <Grid Margin="12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- User info -->
                <TextBlock Grid.Column="0" x:Name="UserLabel" Text="User: Loading..."
                           Foreground="#B0C4DE" VerticalAlignment="Center"/>

                <!-- Status message -->
                <TextBlock Grid.Column="1" x:Name="StatusLabel" Text="Ready"
                           Foreground="#B0C4DE" VerticalAlignment="Center" Margin="20,0,0,0"/>

                <!-- Database status -->
                <Border Grid.Column="2" CornerRadius="3" Padding="8,2" Margin="8,0"
                        Background="{DynamicResource SuccessBackgroundBrush}">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="{DynamicResource SuccessBrush}" Margin="0,0,6,0"/>
                        <TextBlock x:Name="DbStatusLabel" Text="DB Connected" Foreground="{DynamicResource SuccessBrush}" FontSize="11"/>
                    </StackPanel>
                </Border>

                <!-- X Target status -->
                <Border Grid.Column="3" CornerRadius="3" Padding="8,2" Margin="8,0"
                        Background="{DynamicResource InfoBackgroundBrush}">
                    <TextBlock x:Name="XTargetLabel" Text="X Targets: --" Foreground="{DynamicResource InfoBrush}" FontSize="11"/>
                </Border>

                <!-- Version -->
                <TextBlock Grid.Column="4" Text="v1.0.0" Foreground="#607D8B" VerticalAlignment="Center" Margin="8,0,0,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
