<Window x:Class="AirStudio.CommercialManager.Windows.ConfigurationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AirStudio.CommercialManager.Windows"
        mc:Ignorable="d"
        Title="Configuration - AirStudio Commercial Manager"
        Height="650" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}">

    <Window.Resources>
        <local:BoolToYesNoConverter x:Key="BoolToYesNoConverter"/>
        <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="CONFIGURATION" FontSize="20" FontWeight="Bold"
                   Foreground="{DynamicResource ForegroundBrush}" Margin="0,0,0,16"/>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
                    <Setter Property="Padding" Value="16,8"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="border" Background="{TemplateBinding Background}"
                                        CornerRadius="4,4,0,0" Padding="{TemplateBinding Padding}"
                                        Margin="0,0,2,0">
                                    <ContentPresenter ContentSource="Header"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryAccentBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="{DynamicResource ControlBackgroundHoverBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <!-- Databases Tab -->
            <TabItem Header="Databases">
                <Border Style="{StaticResource StudioPanel}" Margin="0,8,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Database Profiles" FontWeight="SemiBold"
                                   Foreground="#B0C4DE" Margin="0,0,0,8"/>

                        <!-- Database Profiles List -->
                        <DataGrid Grid.Row="1" x:Name="DatabasesGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Default" Binding="{Binding IsDefault}" Width="60" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Host/IP" Binding="{Binding Host}" Width="150" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Port" Binding="{Binding Port}" Width="60" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Password" Binding="{Binding PasswordDisplay, Mode=OneWay}" Width="100" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Database Actions -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                            <Button Content="Add" Click="AddDatabase_Click" Width="80"/>
                            <Button Content="Edit" Click="EditDatabase_Click" Width="80"/>
                            <Button Content="Remove" Click="RemoveDatabase_Click" Width="80"/>
                            <Button Content="Test Connection" Click="TestConnection_Click" Width="120" Margin="20,0,0,0"/>
                            <Button Content="Set as Default" Click="SetDefault_Click" Width="100"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Locations Tab -->
            <TabItem Header="Locations">
                <Border Style="{StaticResource StudioPanel}" Margin="0,8,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Channel X Root Targets" FontWeight="SemiBold"
                                   Foreground="#B0C4DE" Margin="0,0,0,8"/>

                        <!-- Channel Locations List -->
                        <DataGrid Grid.Row="1" x:Name="LocationsGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserResizeRows="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Channel" Binding="{Binding Channel}" Width="150"/>
                                <DataGridTextColumn Header="X Root Targets" Binding="{Binding XRootTargetsDisplay}" Width="*"/>
                                <DataGridTemplateColumn Header="Configured" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding IsConfigured, Converter={StaticResource BoolToYesNoConverter}}"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="{Binding IsConfigured, Converter={StaticResource BoolToColorConverter}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Location Actions -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                            <Button Content="Edit Targets" Click="EditTargets_Click" Width="100"/>
                            <Button Content="Add Target" Click="AddTarget_Click" Width="100"/>
                            <Button Content="Remove Target" Click="RemoveTarget_Click" Width="100"/>
                            <Button Content="Test Targets" Click="TestTargets_Click" Width="100" Margin="20,0,0,0"/>
                            <Button Content="Refresh Channels" Click="RefreshChannels_Click" Width="120"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Users Tab -->
            <TabItem Header="Users">
                <Border Style="{StaticResource StudioPanel}" Margin="0,8,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="0,0,0,8">
                            <TextBlock Text="Allowed Users" FontWeight="SemiBold" Foreground="#B0C4DE"/>
                            <TextBlock Text="Check the users who should be allowed to use this application."
                                       Foreground="#607D8B" FontSize="11" Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Search and Refresh -->
                        <Grid Grid.Row="1" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="UserSearchTextBox" Grid.Column="0" Height="28"
                                     TextChanged="UserSearchTextBox_TextChanged"
                                     VerticalContentAlignment="Center" Margin="0,0,8,0"/>
                            <Button Grid.Column="1" Content="Load Domain Users" Click="LoadDomainUsers_Click"
                                    Width="140" Height="28"/>
                        </Grid>

                        <!-- Domain Users Grid -->
                        <DataGrid Grid.Row="2" x:Name="UsersDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Allow" Binding="{Binding IsAllowed, UpdateSourceTrigger=PropertyChanged}" Width="50"/>
                                <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="200" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="*" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- User Actions -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal">
                            <Button Content="Add Manual User" Click="AddUser_Click" Width="120"/>
                            <Button Content="Add Current User" Click="AddCurrentUser_Click" Width="120"/>
                            <TextBlock x:Name="UserCountLabel" Text="0 users allowed" VerticalAlignment="Center"
                                       Foreground="#607D8B" Margin="20,0,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Advanced Tab -->
            <TabItem Header="Advanced">
                <Border Style="{StaticResource StudioPanel}" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="Advanced Settings" FontWeight="SemiBold"
                                   Foreground="#B0C4DE" Margin="0,0,0,16"/>

                        <!-- Sequence Base NN -->
                        <StackPanel Margin="0,0,0,16">
                            <Label Content="Sequence Base NN (for TAG files)"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="SequenceBaseNNTextBox" Width="80" Text="27"/>
                                <TextBlock Text="Default: 27" Foreground="#607D8B" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <Separator Margin="0,16" Background="#3D5A80"/>

                        <!-- Export/Import -->
                        <TextBlock Text="Configuration Export/Import" FontWeight="SemiBold"
                                   Foreground="#B0C4DE" Margin="0,0,0,8"/>
                        <TextBlock Text="Export includes database passwords encrypted with AES (passphrase: 'air')"
                                   Foreground="#607D8B" FontSize="11" Margin="0,0,0,12"/>

                        <StackPanel Orientation="Horizontal">
                            <Button Content="Export Settings" Click="ExportSettings_Click" Width="120" Style="{StaticResource PrimaryButtonStyle}"/>
                            <Button Content="Import Settings" Click="ImportSettings_Click" Width="120"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </TabItem>
        </TabControl>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Save Changes" Click="SaveChanges_Click" Width="120" Style="{StaticResource PrimaryButtonStyle}"/>
            <Button Content="Cancel" Click="Cancel_Click" Width="100"/>
        </StackPanel>
    </Grid>
</Window>
